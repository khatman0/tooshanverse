<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>چت آنلاین — توشان‌ورس</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0a0f2a;
      --card-bg: rgba(20,40,70,0.6);
      --accent: #4aa3ff;
      --muted: rgba(255,255,255,0.1);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Vazirmatn',sans-serif;
      background: linear-gradient(180deg,#0a0f2a,#06112b);
      color:#fff;
      height:100vh;
      display:flex;
      flex-direction:column;
    }
    header{
      padding:16px;
      font-size:1.2rem;
      font-weight:700;
      color:var(--accent);
      border-bottom:1px solid var(--muted);
    }
    #chatContainer{
      flex:1;
      display:flex;
      flex-direction:column;
      padding:16px;
      overflow-y:auto;
      gap:8px;
    }
    .message{
      background:var(--card-bg);
      padding:10px 14px;
      border-radius:10px;
      max-width:70%;
      word-wrap:break-word;
    }
    .message.self{
      margin-left:auto;
      background:#1e3f7f;
    }
    #inputRow{
      display:flex;
      border-top:1px solid var(--muted);
    }
    #msgInput{
      flex:1;
      padding:12px;
      border:none;
      background:var(--card-bg);
      color:#fff;
      border-radius:0;
      font-size:1rem;
    }
    #sendBtn{
      padding:12px 16px;
      border:none;
      background:var(--accent);
      color:#111;
      cursor:pointer;
      font-weight:600;
    }
    #sendBtn:hover{opacity:0.9}
  </style>
</head>
<body>

<header>چت آنلاین — توشان‌ورس</header>

<div id="chatContainer"></div>

<div id="inputRow">
  <input type="text" id="msgInput" placeholder="پیام خود را بنویسید...">
  <button id="sendBtn">ارسال</button>
</div>

<script>
  // --------- این قسمت باید با سرور شما مطابقت داشته باشد ---------
  // فرض: کاربر قبلاً وارد شده و یک نام کاربری داریم
  const username = localStorage.getItem('username') || 'کاربر ناشناس';

  const chatContainer = document.getElementById('chatContainer');
  const msgInput = document.getElementById('msgInput');
  const sendBtn = document.getElementById('sendBtn');

  // اتصال WebSocket به سرور
  const ws = new WebSocket('ws://localhost:3000'); // جایگزین سرور خودت

  ws.onopen = ()=> console.log('اتصال برقرار شد');

  ws.onmessage = (event)=>{
    const data = JSON.parse(event.data);
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message');
    if(data.username === username) msgDiv.classList.add('self');
    msgDiv.innerHTML = `<strong>${data.username}</strong>: ${data.text}`;
    chatContainer.appendChild(msgDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  sendBtn.addEventListener('click', sendMessage);
  msgInput.addEventListener('keypress', (e)=>{ if(e.key==='Enter') sendMessage(); });

  function sendMessage(){
    const text = msgInput.value.trim();
    if(!text) return;
    ws.send(JSON.stringify({username,text}));
    msgInput.value = '';
  }
</script>

</body>
</html>
